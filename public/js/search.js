document.addEventListener("DOMContentLoaded",async()=>{let e=document.getElementById("search-container"),t=document.getElementById("search-input"),a=document.getElementById("search-button"),n=document.getElementById("search-results"),s=document.getElementById("tag-dropdown-btn"),r=document.getElementById("tag-dropdown-menu"),d=document.getElementById("search-close"),i="",l,c=async()=>{try{let e=await fetch("/api/tags/fetch");if(!e.ok)throw Error("Failed to fetch tags");let a=await e.json();r.innerHTML="",a.forEach(e=>{let t=document.createElement("div");t.className="p-2 cursor-pointer hover:bg-gray-100 rounded-md",t.setAttribute("data-tag-id",e.id),t.textContent=e.name,r.appendChild(t)}),r.addEventListener("click",e=>{let a=e.target;i=a.getAttribute("data-tag-id"),s.textContent=a.textContent,r.classList.add("hidden"),t.value.trim().length>2&&o(t.value.trim(),i)})}catch(n){console.error("Error fetching tags:",n)}},o=async(e,t)=>{clearTimeout(l),l=setTimeout(async()=>{try{let a=await fetch(`/api/search?query=${encodeURIComponent(e)}&tag=${encodeURIComponent(t)}`);if(!a.ok)throw Error("Failed to fetch search results");let s=await a.json();n.innerHTML="",s.length>0?(n.classList.remove("hidden"),s.forEach(e=>{let t=document.createElement("div");t.className="py-2 border-b border-gray-300",t.innerHTML=`
    <a href="/questions/${e.id}" class="block hover:bg-gray-100 rounded-md p-2">
        <p class="font-bold">${e.title}</p>
        <p class="text-sm text-gray-500">
            ${e.post.body.substring(0,100)}...
        </p>
        <p class="text-sm text-gray-500">
            ${e.tags.map(e=>`#${e.name}`).join(" ")}
        </p>
    </a>
`,n.appendChild(t)})):(n.classList.remove("hidden"),n.innerHTML='<p class="py-4 text-center text-gray-500">No results found.</p>')}catch(r){console.error("Error fetching search results:",r)}},300)};await c(),t.addEventListener("input",()=>{let e=t.value.trim();e.length>2?o(e,i):n.classList.add("hidden")}),s.addEventListener("click",()=>{r.classList.toggle("hidden")}),document.addEventListener("click",e=>{r.contains(e.target)||e.target===s||r.classList.add("hidden")}),d.addEventListener("click",()=>{t.value="",n.innerHTML="",i="",s.textContent="All Tags"}),a.addEventListener("click",()=>{e.classList.toggle("hidden")})});